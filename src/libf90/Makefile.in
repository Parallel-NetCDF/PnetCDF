#
# Copyright (C) 2013, Northwestern University and Argonne National Laboratory
# See COPYRIGHT notice in top-level directory.
#
# $Id$
#
# @configure_input@

srcdir = @srcdir@
VPATH = @srcdir@

# generated by configure, so it's in the build dir, not srcdirr
include ../../macros.make

# F90FLAGS = @FC_DEFINE@MPI_OFFSET_KIND=@SIZEOF_MPI_OFFSET@

INCLUDES = -I. -I$(srcdir) -I$(srcdir)/../lib -I../lib

LIBRARY = ../lib/libpnetcdf.a

PNETCDF_MOD = pnetcdf.@FC_MODEXT@
ifeq (@UPPER_CASE_MOD@, yes)
  PNETCDF_MOD = PNETCDF.@FC_MODEXT@
endif

F90FLAGS += @FC_MODOUT@.
M4FLAGS  += -Dinout=@INOUT@

M4_SRCS = getput_text.m4 \
          getput_var.m4 \
          getput_varn.m4 \
          getput_vard.m4

F90_SRCS = nf90_constants.f90 \
           overloads.f90 \
           visibility.f90 \
           file.f90 \
           dims.f90 \
           attributes.f90 \
           variables.f90 \
           pnetcdf.f90

SRCS     = $(F90_SRCS) $(M4_SRCS:.m4=.f90) \
           api.f90 nfmpi_constants.f90

LIB_OBJS = pnetcdf.o

PACKING_LIST = $(F90_SRCS) \
               $(M4_SRCS) \
               Makefile.in \
               api.f90.in \
               nfmpi_constants.f90.in

GARBAGE		= $(PNETCDF_MOD) $(M4_SRCS:.m4=.f90)
DIST_GARBAGE	= api.f90 nfmpi_constants.f90

all: $(LIBRARY)

objs: $(LIB_OBJS)

library $(LIBRARY): $(LIB_OBJS)
	$(AR) $(ARFLAGS) $(LIBRARY) $(LIB_OBJS)
	$(RANLIB) $(LIBRARY)

$(LIB_OBJS): $(SRCS)
	$(COMPILE.F90) $(srcdir)/pnetcdf.f90

$(PNETCDF_MOD): $(SRCS)
	$(COMPILE.F90) $(srcdir)/pnetcdf.f90

install:
	$(INSTALL) -d -m 755 $(INCDIR)
	$(INSTALL_DATA) $(PNETCDF_MOD) $(INCDIR)

uninstall:
	$(RM) -f $(INCDIR)/$(PNETCDF_MOD)

include $(srcdir)/../../rules.make

