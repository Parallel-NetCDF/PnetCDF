#
# Copyright (C) 2014, Northwestern University and Argonne National Laboratory
# See COPYRIGHT notice in top-level directory.
#
# $Id$
#
# @configure_input@

srcdir = @srcdir@
VPATH  = @srcdir@

# generated by configure, so it's in the build dir, not srcdirr
include ../../macros.make

INCLUDES = -I. -I$(srcdir) -I../lib

CXX_HEADER = pnetcdf

LIBRARY = ../lib/libpnetcdf.a

# Note the file order is important
LIBS_HEADERS = ncmpi_notyet.h \
               ncmpiCheck.h \
               ncmpiType.h \
               ncmpiAtt.h \
               ncmpiEnumType.h \
               ncmpiGroupAtt.h \
               ncmpiGroup.h \
               ncmpiByte.h \
               ncmpiChar.h \
               ncmpiCompoundType.h \
               ncmpiDouble.h \
               ncmpiFloat.h \
               ncmpiInt.h \
               ncmpiInt64.h \
               ncmpiOpaqueType.h \
               ncmpiShort.h \
               ncmpiUbyte.h \
               ncmpiUint.h \
               ncmpiUint64.h \
               ncmpiUshort.h \
               ncmpiException.h \
               ncmpiDim.h \
               ncmpiFile.h \
               ncmpiVarAtt.h \
               ncmpiVar.h \
               ncmpiVlenType.h

LIB_SRCS   = $(LIBS_HEADERS:.h=.cpp)

LIB_OBJS   = $(LIBS_HEADERS:.h=.o)

PACKING_LIST = $(LIBS_HEADERS) $(LIB_SRCS) pnetcdf.in \
               Makefile.in depend

GARBAGE      = $(LIB_OBJS) $(CXX_HEADER)
DIST_GARBAGE =

all: $(CXX_HEADER) $(LIBRARY)

objs:  $(CXX_HEADER) $(LIB_OBJS)

library $(LIBRARY): $(LIB_OBJS)
	$(AR) $(ARFLAGS) $(LIBRARY) $(LIB_OBJS)
	$(RANLIB) $(LIBRARY)

$(CXX_HEADER): $(LIBS_HEADERS)
	cp -f $(srcdir)/pnetcdf.in $(CXX_HEADER)
	set -e; for i in $(LIBS_HEADERS); do ( \
	sed -e '/#ifndef/d' -e '/#define/d' -e '/#endif/d' -e '/#include/d' $(srcdir)/$$i >> $(CXX_HEADER); \
	) ; done

install:
	$(INSTALL) -d -m 755 $(INCDIR)
	$(INSTALL_DATA) $(CXX_HEADER) $(INCDIR)

uninstall:
	$(RM) -f $(INCDIR)/$(CXX_HEADER)

include $(srcdir)/depend
include $(srcdir)/../../rules.make

